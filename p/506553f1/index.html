<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.0.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/avatar.gif">
  <link rel="icon" type="image/png" sizes="32x32" href="/avatar.gif">
  <link rel="icon" type="image/png" sizes="16x16" href="/avatar.gif">
  <link rel="mask-icon" href="/avatar.gif" color="#222">
  <meta name="google-site-verification" content="4daZSdfkhclsb8lNlb-oQ21e4sT9t7uE3MuPCc6mSQ0">
  <meta name="msvalidate.01" content="90632BDD7F175734738C409EB1F8430D">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Bree+Serif:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="/lib/@fortawesome/fontawesome-free/css/all.min.css" integrity="sha256-wiz7ZSCn/btzhjKDQBms9Hx4sSeUYsDrTLg7roPstac=" crossorigin="anonymous">
  <link rel="stylesheet" href="/lib/animate.css/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="/lib/@fancyapps/ui/dist/fancybox/fancybox.css" integrity="sha256-gkQVf8UKZgQ0HyuxL/VnacadJ+D2Kox2TCEBuNQg5+w=" crossorigin="anonymous">
  <link rel="stylesheet" href="/lib/pace-js/themes/blue/pace-theme-minimal.css">
  <script src="/lib/pace-js/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"umm.js.org","root":"/","images":"/images","scheme":"Pisces","darkmode":true,"version":"8.19.2","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"width":250},"copycode":{"enable":true,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"},"path":"/search.json","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="ä¿®æ”¹äº†ä¸€ä¸ªåŸºäºFlaskçš„é’å¹´å¤§å­¦ä¹ çš„æˆªå›¾ç”Ÿæˆå™¨ï¼Œç”Ÿæˆç±»å¾®ä¿¡æˆªå›¾ã€‚ç„¶åå°†é¡¹ç›®å®¹å™¨åŒ–ï¼Œåˆ¶ä½œDockerfileå’Œdocker-composeè¿›è¡Œç®¡ç†ï¼Œé€šè¿‡Dockerä¸€é”®éƒ¨ç½²ã€‚ è¿™ç©æ„æœ‰ä»€ä¹ˆç”¨ï¼Ÿè¿˜çœŸæ²¡æœ‰ï¼Œå¦‚æœä½ çŸ¥é“é’å¹´å¤§å­¦ä¹ æ˜¯ä»€ä¹ˆï¼Œä½ å°±çŸ¥é“æœ‰ï¼ˆæ²¡ï¼‰å•¥ç”¨ï¼Œå°±å½“ç»ƒæ‰‹äº†ã€‚ é‡è¦çš„æ˜¯ï¼Œå¯¹Dockeræœ‰äº†è¿›ä¸€æ­¥çš„ç†è§£ä»¥åŠç†Ÿæ‚‰ã€‚é¡¹ç›®åœ°å€">
<meta property="og:type" content="article">
<meta property="og:title" content="Docker éƒ¨ç½² Flask App">
<meta property="og:url" content="https://umm.js.org/p/506553f1/">
<meta property="og:site_name" content="ä¸‰åˆ†ä¹‹ä¸ƒæ©™">
<meta property="og:description" content="ä¿®æ”¹äº†ä¸€ä¸ªåŸºäºFlaskçš„é’å¹´å¤§å­¦ä¹ çš„æˆªå›¾ç”Ÿæˆå™¨ï¼Œç”Ÿæˆç±»å¾®ä¿¡æˆªå›¾ã€‚ç„¶åå°†é¡¹ç›®å®¹å™¨åŒ–ï¼Œåˆ¶ä½œDockerfileå’Œdocker-composeè¿›è¡Œç®¡ç†ï¼Œé€šè¿‡Dockerä¸€é”®éƒ¨ç½²ã€‚ è¿™ç©æ„æœ‰ä»€ä¹ˆç”¨ï¼Ÿè¿˜çœŸæ²¡æœ‰ï¼Œå¦‚æœä½ çŸ¥é“é’å¹´å¤§å­¦ä¹ æ˜¯ä»€ä¹ˆï¼Œä½ å°±çŸ¥é“æœ‰ï¼ˆæ²¡ï¼‰å•¥ç”¨ï¼Œå°±å½“ç»ƒæ‰‹äº†ã€‚ é‡è¦çš„æ˜¯ï¼Œå¯¹Dockeræœ‰äº†è¿›ä¸€æ­¥çš„ç†è§£ä»¥åŠç†Ÿæ‚‰ã€‚é¡¹ç›®åœ°å€">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://umm.js.org/p/506553f1/head.jpg">
<meta property="og:image" content="https://umm.js.org/p/506553f1/result.jpg">
<meta property="og:image" content="https://umm.js.org/p/506553f1/docker.svg">
<meta property="og:image" content="https://umm.js.org/p/506553f1/docker-portforward.svg">
<meta property="article:published_time" content="2020-03-25T11:11:23.000Z">
<meta property="article:modified_time" content="2023-01-22T06:32:23.000Z">
<meta property="article:author" content="Seeno">
<meta property="article:tag" content="Python">
<meta property="article:tag" content="DevOps">
<meta property="article:tag" content="Docker">
<meta property="article:tag" content="Docker Compose">
<meta property="article:tag" content="Flask">
<meta property="article:tag" content="Nginx">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://umm.js.org/p/506553f1/head.jpg">


<link rel="canonical" href="https://umm.js.org/p/506553f1/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://umm.js.org/p/506553f1/","path":"p/506553f1/","title":"Docker éƒ¨ç½² Flask App"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Docker éƒ¨ç½² Flask App | ä¸‰åˆ†ä¹‹ä¸ƒæ©™</title>
  








<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8341793904124783"
     crossorigin="anonymous"></script>


  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="ä¸‰åˆ†ä¹‹ä¸ƒæ©™" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">ä¸‰åˆ†ä¹‹ä¸ƒæ©™</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="æœç´¢" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a></li><li class="menu-item menu-item-shorts"><a href="/shorts/" rel="section"><i class="fa fa-hashtag fa-fw"></i>shorts</a></li><li class="menu-item menu-item-game"><a href="/game/" rel="section"><i class="fa fa-gamepad fa-fw"></i>game</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äº</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="æœç´¢..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>



  <script>
    var OriginTitile = document.title;
    var titleTime;
    document.addEventListener('visibilitychange', function() {
      if (document.hidden) {
        document.title = '(â—â€”â—)æˆ‘è—å¥½äº†ï¼';
        clearTimeout(titleTime);
      } else {
        document.title = '(/â‰§â–½â‰¦/)è¢«æ‰¾åˆ°äº†ï¼';
        titleTime = setTimeout(function() {
          document.title = OriginTitile;
        }, 2000);
      }
    });
  </script>


</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#P%E5%9B%BE"><span class="nav-number">1.</span> <span class="nav-text">På›¾</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Docker%E9%83%A8%E7%BD%B2"><span class="nav-number">2.</span> <span class="nav-text">Dockeréƒ¨ç½²</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E5%86%99Dockerfile"><span class="nav-number">2.1.</span> <span class="nav-text">ç¼–å†™Dockerfile</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#docker-compose"><span class="nav-number">2.2.</span> <span class="nav-text">docker-compose</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%83%A8%E7%BD%B2"><span class="nav-number">2.3.</span> <span class="nav-text">éƒ¨ç½²</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93"><span class="nav-number">2.4.</span> <span class="nav-text">å°ç»“</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Nginx"><span class="nav-number">3.</span> <span class="nav-text">Nginx</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%80%E5%90%8E"><span class="nav-number">4.</span> <span class="nav-text">æœ€å</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Docker"><span class="nav-number">4.1.</span> <span class="nav-text">Docker</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Flask"><span class="nav-number">4.2.</span> <span class="nav-text">Flask</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#url-for"><span class="nav-number">4.2.1.</span> <span class="nav-text">url_for</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E7%BC%93%E5%AD%98"><span class="nav-number">4.2.2.</span> <span class="nav-text">é™æ€èµ„æºç¼“å­˜</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83"><span class="nav-number">5.</span> <span class="nav-text">å‚è€ƒ</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Seeno"
      src="/avatar.gif">
  <p class="site-author-name" itemprop="name">Seeno</p>
  <div class="site-description" itemprop="description">233 no fun</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">83</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">19</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">99</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/umm233" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;umm233" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:umm233@protonmail.com" title="E-Mail â†’ mailto:umm233@protonmail.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS â†’ &#x2F;atom.xml" rel="noopener me"><i class="fa fa-rss fa-fw"></i>RSS</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
          é“¾æ¥
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <a href="https://blog.xlab.app/" title="https:&#x2F;&#x2F;blog.xlab.app" rel="noopener" target="_blank">æ˜å¤©çš„ä¹Œäº‘</a>
            </li>
        </ul>
      </div>
    </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://umm.js.org/p/506553f1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/avatar.gif">
      <meta itemprop="name" content="Seeno">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ä¸‰åˆ†ä¹‹ä¸ƒæ©™">
      <meta itemprop="description" content="233 no fun">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Docker éƒ¨ç½² Flask App | ä¸‰åˆ†ä¹‹ä¸ƒæ©™">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Docker éƒ¨ç½² Flask App
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2020-03-25 19:11:23" itemprop="dateCreated datePublished" datetime="2020-03-25T19:11:23+08:00">2020-03-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2023-01-22 14:32:23" itemprop="dateModified" datetime="2023-01-22T14:32:23+08:00">2023-01-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/DevOps/" itemprop="url" rel="index"><span itemprop="name">DevOps</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="é˜…è¯»æ¬¡æ•°" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>6.1k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>6 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>ä¿®æ”¹äº†ä¸€ä¸ªåŸºäºFlaskçš„é’å¹´å¤§å­¦ä¹ çš„æˆªå›¾ç”Ÿæˆå™¨ï¼Œç”Ÿæˆç±»å¾®ä¿¡æˆªå›¾ã€‚ç„¶åå°†é¡¹ç›®å®¹å™¨åŒ–ï¼Œåˆ¶ä½œDockerfileå’Œdocker-composeè¿›è¡Œç®¡ç†ï¼Œé€šè¿‡Dockerä¸€é”®éƒ¨ç½²ã€‚</p>
<p>è¿™ç©æ„æœ‰ä»€ä¹ˆç”¨ï¼Ÿè¿˜çœŸæ²¡æœ‰ï¼Œå¦‚æœä½ çŸ¥é“é’å¹´å¤§å­¦ä¹ æ˜¯ä»€ä¹ˆï¼Œä½ å°±çŸ¥é“æœ‰ï¼ˆæ²¡ï¼‰å•¥ç”¨ï¼Œå°±å½“ç»ƒæ‰‹äº†ã€‚</p>
<p>é‡è¦çš„æ˜¯ï¼Œå¯¹Dockeræœ‰äº†è¿›ä¸€æ­¥çš„ç†è§£ä»¥åŠç†Ÿæ‚‰ã€‚<a target="_blank" rel="noopener" href="https://github.com/umm233/FuckQNDXX">é¡¹ç›®åœ°å€</a></p>
<span id="more"></span>

<h2 id="På›¾"><a href="#På›¾" class="headerlink" title="På›¾"></a>På›¾</h2><p>è¿™ä¸€æ­¥æ˜¯å°†è·å¾—çš„å­¦ä¹ ç»“æŸæˆªå›¾ï¼ŒPæˆä»å¾®ä¿¡é‡Œæˆªå›¾çš„æ ·å­ï¼Œä½¿ç”¨PILç»˜åˆ¶ä¸€ä¸ª<code>head.jpg</code>ï¼Œç„¶åä¸åŸå›¾è¿›è¡Œæ‹¼æ¥å¾—åˆ°å¾®ä¿¡æˆªå›¾çš„æ ·å­ã€‚è¿™é‡Œç®€ç•¥ä»‹ç»ä»¥ä¸‹PILå‡ ä¸ªæ–¹æ³•çš„ä½¿ç”¨ï¼š</p>
<ul>
<li><p>ç”Ÿæˆç”»å¸ƒï¼Œå­¦ä¹ ç»“æŸå›¾ç‰‡çš„å®½æ˜¯828pxï¼Œ</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿™é‡Œçš„ä¸‰ä¸ªå‚æ•°åˆ†åˆ«æ˜¯å›¾ç‰‡æ¨¡å¼ï¼Œç”»å¸ƒå¤§å°ï¼Œä»¥åŠç”»å¸ƒèƒŒæ™¯</span></span><br><span class="line">img = Image.new(<span class="string">&#x27;RGB&#x27;</span>, (<span class="number">828</span>, <span class="number">78</span>), (<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>))</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç»˜åˆ¶æ–‡æœ¬</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿™é‡Œçš„font_typeæ˜¯æŒ‡å­—ä½“çš„è·¯å¾„</span></span><br><span class="line">font = ImageFont.truetype(font_type, <span class="number">28</span>)</span><br><span class="line">draw = ImageDraw.Draw(img)</span><br><span class="line"><span class="comment"># å›¾ç‰‡æ·»åŠ æ–‡å­—ï¼Œä¸‰ä¸ªå‚æ•°åˆ†åˆ«è¡¨ç¤ºæ–‡æœ¬å·¦ä¸Šè§’çš„åæ ‡ï¼ˆç”»å¸ƒå·¦ä¸Šè§’ä¸ºåæ ‡åŸç‚¹ï¼‰ã€æ–‡æœ¬å†…å®¹ã€é¢œè‰²å’Œå­—ä½“</span></span><br><span class="line">draw.text((<span class="number">60</span>, <span class="number">20</span>), title, color, font=font)</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¿å­˜å›¾ç‰‡</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">img.save(<span class="string">&quot;./static/img/qndxx/head.jpg&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><img data-src="/p/506553f1/head.jpg" alt="head"></p>
</li>
<li><p>å›¾ç‰‡æ‹¼æ¥</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ç»˜åˆ¶ä¸€ä¸ªæœ€ç»ˆå¤§å°çš„ç”»å¸ƒ</span><br><span class="line">merge_img = Image.new(<span class="string">&#x27;RGB&#x27;</span>, (size1[<span class="number">0</span>], size1[<span class="number">1</span>]+size2[<span class="number">1</span>]))</span><br><span class="line"><span class="comment"># æ‹¼æ¥åæ ‡</span></span><br><span class="line">loc1, loc2 = (<span class="number">0</span>, <span class="number">0</span>), (<span class="number">0</span>, size1[<span class="number">1</span>])</span><br><span class="line"><span class="comment"># å°†å›¾ç‰‡å·¦ä¸Šè§’å¯¹é½æ‹¼æ¥åæ ‡ï¼Œç²˜è´´</span></span><br><span class="line">merge_img.paste(img1, loc1)</span><br><span class="line">merge_img.paste(down_img, loc2)</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å­å°±ç”Ÿæˆäº†å‡çš„å¾®ä¿¡æˆªå›¾ï¼š</p>
<p><img data-src="/p/506553f1/result.jpg"></p>
</li>
</ul>
<h2 id="Dockeréƒ¨ç½²"><a href="#Dockeréƒ¨ç½²" class="headerlink" title="Dockeréƒ¨ç½²"></a>Dockeréƒ¨ç½²</h2><p>å› ä¸ºä¸å¯èƒ½ä¸€ç›´æœ¬åœ°æ‰“å¼€è¿è¡Œï¼Œç„¶åç”Ÿæˆæˆªå›¾ï¼Œæ‰€ä»¥ä¸¢ä¸€ä¸ªåœ¨æœåŠ¡å™¨ä¸Šè·‘ã€‚</p>
<p>ç„¶åæ€ä¹ˆè·‘ï¼Ÿå­¦ä¹ äº†ä¸€æ³¢é¡¹ç›®å®¹å™¨åŒ–ã€‚</p>
<h3 id="ç¼–å†™Dockerfile"><a href="#ç¼–å†™Dockerfile" class="headerlink" title="ç¼–å†™Dockerfile"></a>ç¼–å†™Dockerfile</h3><p>Dockerfileåƒæ˜¯ä¸€ä¸ªè„šæœ¬ï¼Œé‡Œé¢ç¼–å†™å¥½å‘½ä»¤ï¼Œç„¶åå®¹å™¨åˆ›å»ºçš„æ—¶å€™ä¼šæ ¹æ®æ­¥éª¤ä¸€æ­¥ä¸€æ­¥æ„å»ºã€‚é€šè¿‡Dockerfileå¯ä»¥å®ç°è‡ªåŠ¨åŒ–æ„å»ºé¡¹ç›®å®¹å™¨ã€‚</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> python:<span class="number">3.7</span>-alpine AS build</span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> sed -i <span class="string">&#x27;s/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g&#x27;</span> /etc/apk/repositories \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; apk update \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; apk add git gcc musl-dev libffi-dev openssl-dev make</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> pip install --upgrade pip</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apk --no-cache add git \</span></span><br><span class="line"><span class="language-bash">                       jpeg-dev \</span></span><br><span class="line"><span class="language-bash">                       zlib-dev \</span></span><br><span class="line"><span class="language-bash">                       freetype-dev \</span></span><br><span class="line"><span class="language-bash">                       lcms2-dev \</span></span><br><span class="line"><span class="language-bash">                       openjpeg-dev \</span></span><br><span class="line"><span class="language-bash">                       tiff-dev \</span></span><br><span class="line"><span class="language-bash">                       tk-dev \</span></span><br><span class="line"><span class="language-bash">                       tcl-dev \</span></span><br><span class="line"><span class="language-bash">                       harfbuzz-dev \</span></span><br><span class="line"><span class="language-bash">                       fribidi-dev</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> git <span class="built_in">clone</span> https://github.com/umm233/FuckQNDXX</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œè§£é‡Šä»¥ä¸‹æ¯å¥è¯çš„ä½œç”¨ï¼š</p>
<ul>
<li><p>ç¬¬1è¡Œçš„ä½¿ç”¨<code>python:3.7-alpine</code>é•œåƒæ„å»ºåŸºç¡€å®¹å™¨ã€‚</p>
<p>è¿™é‡Œä¸ºä»€ä¹ˆé€‰æ‹©alpineç‰ˆæœ¬çš„pythonå®¹å™¨ï¼Ÿå› ä¸ºå¯ä»¥èŠ‚çœç©ºé—´ä»¥åŠå…¶ä½“ç§¯å°ï¼Œä½¿å¾—æ„å»ºè¿‡ç¨‹æ›´å¿«ã€‚</p>
<blockquote>
<p><code>python:3.7-alpine</code> æ˜¯ä¸€ä¸ªåœ¨ Alpine ç³»ç»Ÿä¸‹ Python3.7 é•œåƒï¼Œ<code>Alpine</code> çš„ä¼˜åŠ¿æ˜¯ã€Œç³»ç»Ÿçš„ä½“ç§¯å°ã€(ç³»ç»Ÿé•œåƒçº¦ 5 MBï¼Œè€Œ Ubuntu ç³»åˆ—é•œåƒæ¥è¿‘ 200 MBï¼Œå¯è§ä¸€æ–‘)ã€ã€Œè¿è¡Œæ—¶èµ„æºæ¶ˆè€—ä½ã€å’Œã€Œæä¾›åŒ…ç®¡ç†å·¥å…· <code>apk</code>ï¼ŒåŒ…ç®¡ç†æœºåˆ¶å®Œå–„ã€ç­‰ã€‚æˆ‘æ˜¯å¾ˆæ¨èä½¿ç”¨ Alpine æ›¿ä»£ Ubuntu ä¹‹ç±»ç³»ç»Ÿåšä¸ºåŸºç¡€é•œåƒç¯å¢ƒçš„ã€‚</p>
<p>â€“ å‚è€ƒ<a target="_blank" rel="noopener" href="https://www.dongwm.com/post/use-docker-compose/">Pythoné¡¹ç›®å®¹å™¨åŒ–å®è·µ(ä¸€) - Docker Compose</a></p>
</blockquote>
</li>
<li><p>ç¬¬2-4è¡Œæ˜¯æ¢æºï¼Œä¿®æ”¹ Alpine ä½¿ç”¨å›½å†…ä¸­ç§‘å¤§çš„æºï¼ŒåŠ å¿«è½¯ä»¶ä¸‹è½½é€Ÿåº¦ã€‚</p>
</li>
<li><p>ç¬¬5è¡Œæ›´æ–°pip</p>
</li>
<li><p>ç¬¬6-16è¡Œå®‰è£…PILä¾èµ–</p>
</li>
<li><p>ç¬¬17è¡Œåˆ‡æ¢åˆ°&#x2F;appç›®å½•</p>
</li>
<li><p>ç¬¬18è¡Œè·å–Pythoné¡¹ç›®</p>
</li>
</ul>
<h3 id="docker-compose"><a href="#docker-compose" class="headerlink" title="docker-compose"></a>docker-compose</h3><p>åˆ°è¿™é‡ŒåŸºç¡€ç¯å¢ƒåŸºæœ¬é…ç½®å¥½äº†ï¼Œæ¥ä¸‹æ¥åœ¨<code>docker-compose.yml</code>é‡Œå¯¹å®¹å™¨è¿›ä¸€æ­¥é…ç½®ã€‚</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">web:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">qndxx</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">.</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:35555:8888</span></span><br><span class="line">    <span class="comment"># volumes:</span></span><br><span class="line">    <span class="comment">#   - ./FuckQNDXX:/app/FuckQNDXX</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">sh</span> <span class="string">-c</span> <span class="string">&#x27;cd /app/FuckQNDXX &amp;&amp; pip install -i https://mirrors.ustc.edu.cn/pypi/web/simple -r requirements.txt &amp;&amp; python MainSever.py&#x27;</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>ç¬¬1è¡Œversionæ˜¯æŒ‡composeæ–‡ä»¶æ ¼å¼çš„ç‰ˆæœ¬ï¼Œç†è®ºä¸Šæ ¹æ®å®‰è£…çš„Dockerç‰ˆæœ¬æ¥é€‰æ‹©ã€‚1ã€2ã€3æ˜¯å¤§ç‰ˆæœ¬ï¼Œè¿˜æ˜¯ minor ç‰ˆæœ¬</p>
</li>
<li><p>ç¬¬2è¡Œservicesï¼Œæ¯ä¸ªå®¹å™¨æ˜¯ä¸€ä¸ªæœåŠ¡ï¼Œè¿™é‡Œæ¯”è¾ƒç®€å•ï¼Œè¿™ä¸ªwebåº”ç”¨åªæœ‰qndxxä¸€ä¸ªæœåŠ¡</p>
</li>
<li><p>ç¬¬4è¡Œè®¾ç½®å®¹å™¨åç§°ä¸ºqndxx</p>
</li>
<li><p>ç¬¬5è¡Œæ˜¯å¯¹å½“å‰ç›®å½•é‡Œçš„Dockerfileè¿›è¡Œæ„å»º</p>
</li>
<li><p>ç¬¬6è¡Œè®¾ç½®ç«¯å£æ˜ å°„ï¼Œå°†å®¹å™¨é‡Œçš„8888ç«¯å£æ˜ å°„åˆ°ä¸»æœºç«¯å£çš„35555ä¸Šã€‚è¿™é‡Œæ·»åŠ <code>127.0.0.1</code>æ˜¯ä¸ºåé¢nginxåå‘ä»£ç†åšå‡†å¤‡</p>
</li>
<li><p>ç¬¬8-9è¡Œï¼Œvolumeæ˜¯å·çš„æ„æ€ï¼Œè¿™é‡Œæ˜¯æŒ‚è½½æ–‡ä»¶ï¼Œå°†å½“å‰æ–‡ä»¶å¤¹ä¸‹çš„FuckQNDXXæŒ‚åœ¨åˆ°å®¹å™¨å¯¹åº”ç›®å½•</p>
<blockquote>
<p>è¿™é‡Œè¯´æ˜ä»¥ä¸‹ï¼Œè¿™é‡Œå°†ç¬¬8-9è¡Œæ³¨é‡Šäº†æ˜¯å› ä¸ºä¸€å¼€å§‹è°ƒè¯•ä»£ç åŠæµ‹è¯•ï¼Œé€šè¿‡æŒ‚è½½æ–¹å¼æ¯”è¾ƒæ–¹ä¾¿ï¼Œä¿®æ”¹çš„å†…å®¹å¯ä»¥å®æ—¶æ›´æ–°åˆ°å®¹å™¨ä¸­ï¼ŒåŒæ—¶ï¼ŒFlask appå¼€å¯debugæ¨¡å¼å°±åŸºæœ¬ä¸Šå®ç°äº†çƒ­éƒ¨ç½²</p>
</blockquote>
</li>
<li><p>ç¬¬10è¡Œæ˜¯åˆ‡æ¢ç›®å½•åˆ°é¡¹ç›®ï¼Œå®‰è£…å¿…è¦ä¾èµ–ï¼ˆé€šè¿‡requirments.txtç®¡ç†ï¼‰ï¼Œç„¶åå¯åŠ¨è¯¥åº”ç”¨</p>
</li>
<li><p>ç¬¬11è¡Œè®¾ç½®å®¹å™¨è‡ªåŠ¨é‡å¯</p>
</li>
</ul>
<h3 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h3><p>åœ¨å½“å‰ç›®å½•è¿è¡Œ<code>tree -L 1</code>æŸ¥çœ‹ç›®å½•ç»“æ„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ docker-compose.yml</span><br><span class="line">â”œâ”€â”€ Dockerfile</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œä¸€é”®éƒ¨ç½²ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<p>é…ç½®å¥½åï¼ŒåŸºæœ¬ä¸Šä¸€åŠ³æ°¸é€¸ï¼Œéƒ¨ç½²å°±æ˜¯ä¸Šé¢è¿™ä¹ˆç®€å•ã€‚</p>
<h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>dockeræœ‰ç‚¹åƒè™šæ‹Ÿæœºï¼Œæœ‰ç‹¬ç«‹çš„ç½‘ç»œï¼Œè¿›å…¥å®¹å™¨åå°±è¡Œæ‰“å¼€äº†ä¸€ä¸ªæ–°çš„ç¯å¢ƒã€‚ä½†åœ¨éƒ¨ç½²dockerå®¹å™¨çš„è¿‡ç¨‹ä¸­ï¼Œä½“ä¼šåˆ°dockerå’Œè™šæ‹Ÿæœºä¸ä¸€æ ·çš„åœ°æ–¹ã€‚ç›¸å¯¹æ¥è¯´ï¼Œè™šæ‹Ÿæœºå¯ä»¥è¯´æ˜¯æŒä¹…çš„ï¼Œè€Œdockeræ˜¯ä¸´æ—¶çš„ï¼Œå¯ä»¥åˆ é™¤ï¼Œç„¶åå¿«é€Ÿé‡å»ºã€‚</p>
<p>åœ¨é…ç½®å®¹å™¨è¿‡ç¨‹ä¸­ï¼Œé…ç½®PILçš„ç¯å¢ƒèŠ±äº†ä¸€ç•ªæ—¶é—´ï¼Œå› ä¸ºä¸€å¼€å§‹ä¸çŸ¥é“PILéœ€è¦ä¾èµ–ï¼Œä¹Ÿä¸çŸ¥é“éœ€è¦ä»€ä¹ˆä¾èµ–ï¼Œç„¶åçœ‹<a target="_blank" rel="noopener" href="https://pillow.readthedocs.io/en/stable/installation.html">å®˜æ–¹æ–‡æ¡£</a>é‡Œé¢è¯´æ˜äº†å®‰è£…ä½¿ç”¨PILçš„ä¸€äº›å¿…è¦ä¾èµ–ï¼š</p>
<blockquote>
<p>We provide binaries for Linux for each of the supported Python versions in the manylinux wheel format. These include support for all optional libraries except libimagequant. Raqm support requires libraqm, fribidi, and harfbuzz to be installed separately</p>
<p>ä»¥åŠ</p>
<p>You <strong>do not need to install all supported external libraries</strong> to use Pillowâ€™s basic features. <strong>Zlib</strong> and <strong>libjpeg</strong> are required by default.</p>
<p><strong>ä»¥åŠï¼ˆåˆ’é‡ç‚¹ï¼‰</strong></p>
<p><strong>There are Dockerfiles in our <a target="_blank" rel="noopener" href="https://github.com/python-pillow/docker-images">Docker images repo</a> to install the dependencies for some operating systems.</strong></p>
</blockquote>
<p>åœ¨å®˜æ–¹çš„é•œåƒä»“åº“æ‰¾åˆ°alpineçš„æ„å»ºPILç¯å¢ƒçš„Dockerfileï¼Œå…¶ä¸­åªéœ€è¦PILä¾èµ–éƒ¨åˆ†ï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Pillow dependencies</span></span><br><span class="line">jpeg-dev \</span><br><span class="line">zlib-dev \</span><br><span class="line">freetype-dev \</span><br><span class="line">lcms2-dev \</span><br><span class="line">openjpeg-dev \</span><br><span class="line">tiff-dev \</span><br><span class="line">tk-dev \</span><br><span class="line">tcl-dev \</span><br><span class="line">harfbuzz-dev \</span><br><span class="line">fribidi-dev</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡è¿™ä¸ªåå¤æŠ˜è…¾PILç¯å¢ƒçš„è¿‡ç¨‹ï¼Œä½“ä¼šåˆ°äº†Dockerä¸è™šæ‹Ÿæœºä¹‹é—´çš„åŒºåˆ«ğŸ˜¥ã€‚è¿™ä¸ªè¿‡ç¨‹å°±åƒææ³¥äººï¼Œä½ å¯ä»¥æåˆ°ä½ æƒ³è¦çš„æ ·å­ä¸ºæ­¢ï¼ŒDockerä¹Ÿæ˜¯ä½ å¯ä»¥è°ƒè¯•åˆ°ä½ æ»¡æ„ä¸ºæ­¢ï¼ŒæœŸé—´å®¹å™¨åå¤é‡å»ºã€‚<del>èˆä¸å¾—ä½ å°±è¾“äº†</del></p>
<h2 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h2><p>ä½¿ç”¨Nginxè¿›è¡Œåå‘ä»£ç†ï¼š</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">upstream</span> <span class="string">qndxx &#123;</span></span><br><span class="line">    <span class="attr">server</span> <span class="string">127.0.0.1:35555; # ä¸ä¹‹å‰docker-composeã€‚ymlé‡Œè®¾ç½®æ˜ å°„çš„ä¸»æœºç«¯å£å¯¹åº”</span></span><br><span class="line"><span class="attr">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server</span> <span class="string">&#123;</span></span><br><span class="line">    <span class="attr">listen</span> <span class="string">35553 ssl; # ç›‘å¬35553ç«¯å£ï¼Œè¿™é‡Œæ³¨æ„ä¸è¦å’Œä¸Šé¢upstreamé‡Œçš„ç«¯å£ä¸€æ ·</span></span><br><span class="line">    <span class="attr">gzip</span> <span class="string">on;</span></span><br><span class="line">    <span class="attr">server_name</span>  <span class="string">your-own-domain:35553; # ä¿®æ”¹ä¸ºè‡ªå·±çš„åŸŸå</span></span><br><span class="line">    <span class="attr">access_log</span> <span class="string">/var/log/nginx/qndxx_access.log combined;</span></span><br><span class="line">    <span class="attr">error_log</span>  <span class="string">/var/log/nginx/qndxx_error.log;</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">location</span> <span class="string">/ &#123;</span></span><br><span class="line">        <span class="attr">proxy_redirect</span> <span class="string">off;</span></span><br><span class="line">        <span class="attr">proxy_pass</span> <span class="string">http://qndxx; # è®¾ç½®ä»£ç†æœåŠ¡å™¨ï¼Œè¯·æ±‚å‘é€åˆ°æœ¬åœ°35553ç«¯å£</span></span><br><span class="line"></span><br><span class="line">        <span class="attr">proxy_set_header</span>  <span class="string">Host                $host;</span></span><br><span class="line">        <span class="attr">proxy_set_header</span>  <span class="string">X-Real-IP           $remote_addr;</span></span><br><span class="line">        <span class="attr">proxy_set_header</span>  <span class="string">X-Forwarded-Ssl     on;</span></span><br><span class="line">        <span class="attr">proxy_set_header</span>  <span class="string">X-Forwarded-For     $proxy_add_x_forwarded_for;</span></span><br><span class="line">        <span class="attr">proxy_set_header</span>  <span class="string">X-Forwarded-Proto   $scheme;</span></span><br><span class="line">        <span class="attr">proxy_set_header</span>  <span class="string">X-Frame-Options     SAMEORIGIN;</span></span><br><span class="line"></span><br><span class="line">        <span class="attr">client_max_body_size</span>        <span class="string">100m;</span></span><br><span class="line">        <span class="attr">client_body_buffer_size</span>     <span class="string">128k;</span></span><br><span class="line"></span><br><span class="line">        <span class="attr">proxy_buffer_size</span>           <span class="string">4k;</span></span><br><span class="line">        <span class="attr">proxy_buffers</span>               <span class="string">4 32k;</span></span><br><span class="line">        <span class="attr">proxy_busy_buffers_size</span>     <span class="string">64k;</span></span><br><span class="line">        <span class="attr">proxy_temp_file_write_size</span>  <span class="string">64k;</span></span><br><span class="line">    <span class="attr">&#125;</span></span><br><span class="line"><span class="attr">&#125;</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå¯ä»¥ä½œä¸ºç®€å•çš„Nginxçš„httpsæ¨¡æ¿ä½¿ç”¨ï¼Œéœ€è¦ä¿®æ”¹çš„åœ°æ–¹ä¹Ÿå°±æ˜¯ä¸Šé¢æ³¨é‡Šçš„åœ°æ–¹ã€‚</p>
<h2 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h2><h3 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h3><p>dockerå®¹å™¨åŒ–å¯¹åŸåº”ç”¨è¿›è¡Œä¸€äº›ä¿®æ”¹ï¼Œæ¯”å¦‚<code>MainServer.py</code>ä¸­çš„è¿è¡Œè¯­å¥ï¼š</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="deletion">- app.run(host=&#x27;127.0.0.1&#x27;, port=8888, debug=True)</span></span><br><span class="line"><span class="addition">+ app.run(host=&#x27;0.0.0.0&#x27;, port=8888, debug=True)</span></span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨<code>127.0.0.1</code>ï¼Œä¼šå¯¼è‡´<code>Connection refused</code>ï¼Œä¿®æ”¹æˆ<code>0.0.0.0</code>ç›‘å¬ä½¿ç”¨å¯¹å®¹å™¨qndxxçš„8888ç«¯å£æ‰€æœ‰è¯·æ±‚å³å¯ã€‚è§£é‡Šè¿™ä¸ªåŸå› ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹è¿™ç¯‡æ–‡ç« <a target="_blank" rel="noopener" href="https://pythonspeed.com/articles/docker-connection-refused/">Connection refused? Docker networking and how it impacts your image</a>ï¼Œè¿™é‡ŒæŠŠæ–‡ç« ä¸¤ä¸ªå›¾æ‹¿è¿‡æ¥ç®€å•è§£é‡Šä¸‹ï¼š</p>
<blockquote>
<p>æœåŠ¡å™¨æ­£åœ¨å®¹å™¨ç½‘ç»œåç§°ç©ºé—´å†…ç›‘å¬127.0.0.1ï¼Œä½†æ˜¯ç«¯å£è½¬å‘å°†æŒ‡å‘å¤–éƒ¨IPï¼Œå³172.17.0.2ã€‚</p>
</blockquote>
<p>æ˜æ˜ç™½ç™½çš„è§£é‡Šäº†ï¼ŒæœåŠ¡ç«¯æ²¡æœ‰ç›‘å¬åˆ°æ¥è‡ª172.17.0.2çš„ç«¯å£è¯·æ±‚</p>
<img data-src="docker.svg" style="zoom:40%;" />

<blockquote>
<p>ä¸»æœºç«¯å£è½¬å‘åªèƒ½è¿æ¥åˆ°ä¸€ä¸ªç›®çš„åœ°ï¼Œä½†æ‚¨å¯ä»¥æ›´æ”¹æœåŠ¡å™¨è¿›ç¨‹ç›‘å¬çš„ä½ç½®ã€‚æ‚¨å¯ä»¥é€šè¿‡ç›‘å¬0.0.0.0æ¥å®ç°è¿™ä¸€ç‚¹ï¼Œè¿™æ„å‘³ç€ç›‘å¬æ‰€æœ‰æ¥å£ã€‚</p>
</blockquote>
<img data-src="docker-portforward.svg" style="zoom:40%;" />

<h3 id="Flask"><a href="#Flask" class="headerlink" title="Flask"></a>Flask</h3><h4 id="url-for"><a href="#url-for" class="headerlink" title="url_for"></a>url_for</h4><p>ç€é‡è®²ä¸€ä¸‹å…¶ä¸­<code>url_for</code>å‡½æ•°å‚æ•°è®¾ç½®å¼•å‘çš„é—®é¢˜ã€‚</p>
<p><code>fake_pic.html</code>ä¸­å›¾ç‰‡æ˜¾ç¤ºåŸæ¥æ˜¯ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#123;&#123;url_for</span> (&#x27;<span class="attr">.static</span>&#x27;, <span class="attr">filename</span>=<span class="string">pic_src,</span> <span class="attr">_external</span>=<span class="string">True)&#125;&#125;/</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æœ¬åœ°éƒ¨ç½²å½“ç„¶æ˜¯æ²¡é—®é¢˜ï¼Œä½†æ˜¯ä½¿ç”¨äº†nginxï¼Œä½¿ç”¨çš„æ˜¯å­åŸŸåï¼ˆå¸¦ç«¯å£ï¼‰ï¼ˆ<code>https://test.umm.js.org.com:35553</code>ï¼‰ï¼Œå¯ç”¨<code>_external</code>çš„æƒ…å†µä¸‹ä¼šå¯¼è‡´å›¾ç‰‡çš„åœ°å€ä¸­å°†ç«¯å£è®¾æˆ80ï¼ˆ<code>http://test.um.js.org</code>ï¼‰ï¼Œä½¿å¾—æ˜¾ç¤ºå›¾ç‰‡å¤±è´¥ã€‚æŸ¥äº†ä¸‹<code>_external</code>çš„<a target="_blank" rel="noopener" href="https://flask.palletsprojects.com/en/1.1.x/api/?highlight=_external">ç›¸å…³æ–‡æ¡£</a>ï¼š</p>
<blockquote>
<ul>
<li><strong>_external</strong> â€“ if set to <code>True</code>, an absolute URL is generated. Server address can be changed via <code>SERVER_NAME</code> configuration variable which falls back to the Host header, then to the IP and port of the request.</li>
</ul>
</blockquote>
<p>æˆ‘é‡æ–°è®¾ç½®äº†<code>SERVER_NAME</code>ã€<code>SERVER_PORT</code>å’Œ<code>PREFERRED_URL_SCHEME</code>ï¼Œä½†æ˜¯ä»€ä¹ˆå˜åŒ–æ²¡çœ‹åˆ°ã€‚åæ¥éšæ‰‹åˆ äº†è¿™ä¸ªå‚æ•°ï¼Œå±…ç„¶æ­£å¸¸äº†ï¼Ÿè¿˜ä¸æ˜¯å¾ˆæ˜ç™½ä¸ºä»€ä¹ˆã€‚</p>
<h4 id="é™æ€èµ„æºç¼“å­˜"><a href="#é™æ€èµ„æºç¼“å­˜" class="headerlink" title="é™æ€èµ„æºç¼“å­˜"></a>é™æ€èµ„æºç¼“å­˜</h4><p>é¡¹ç›®éƒ¨ç½²åï¼Œé‡åˆ°é™æ€èµ„æºç¼“å­˜é—®é¢˜ï¼š</p>
<blockquote>
<p>é€šè¿‡æœåŠ¡å™¨è·å–æˆªå›¾å›¾ç‰‡ï¼Œå½“ä¿®æ”¹æœŸæ•°åï¼Œå†æ¬¡ç”Ÿæˆï¼Œæµè§ˆå™¨ä¸­æˆªå›¾å§‹ç»ˆä¸å˜ï¼Œä½†æœåŠ¡å™¨ä¸­çš„æœ€æ–°ç”Ÿæˆçš„æˆªå›¾ï¼ˆ<code>latest.jpg</code>ï¼‰å·²ç»æ›´æ–°ã€‚</p>
</blockquote>
<p>è¿™é‡Œæ¶‰åŠåˆ° flask è®¾ç½®çš„é»˜è®¤å‚æ•°<code>SEND_FILE_MAX_AGE_DEFAULT</code>ï¼Œä¹Ÿå°±æ˜¯ç¼“å­˜çš„æœ€å¤§æ—¶é—´ï¼Œé»˜è®¤æ˜¯ 12hï¼Œå³ 43200sã€‚åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹é™æ€èµ„æºçš„<code>header</code>ä¸­<code>Cache-Control</code>ï¼Œä¹Ÿå°±æ˜¯ç¼“å­˜ç­–ç•¥ï¼Œé»˜è®¤åº”è¯¥æ˜¾ç¤ºçš„æ˜¯<code>43200</code>ã€‚</p>
<p>ç”±äºflaské»˜è®¤è®¾ç½®çš„ç¼“å­˜æ—¶é—´å¤ªé•¿äº†ï¼Œè™½ç„¶æˆ‘ä»¬é‡æ–°å‘é€è¯·æ±‚æ¥è·å–æ–°çš„æˆªå›¾ï¼Œä½†æµè§ˆå™¨è®¤ä¸ºè¿™ä¸ªèµ„æºå·²å­˜åœ¨ï¼ˆæœªè¿‡æœŸï¼‰ï¼Œç”Ÿæˆçš„é¡µé¢ä¹Ÿå°±ä»ä½¿ç”¨ä¹‹å‰ç¼“å­˜çš„å›¾ç‰‡ï¼Œå¹¶æœªé‡æ–°ä»æµè§ˆå™¨è·å–ã€åˆ·æ–°å›¾ç‰‡ï¼Œé€ æˆå›¾ç‰‡æ˜¾ç¤ºé”™è¯¯çš„é—®é¢˜ã€‚</p>
<p>è§£å†³æ–¹æ³•å°±æ˜¯å°†<code>SEND_FILE_MAX_AGE_DEFAULT</code>å‚æ•°è®¾ç½®å°ä¸€ç‚¹å³å¯ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> timedelta</span><br><span class="line">app.config[<span class="string">&#x27;SEND_FILE_MAX_AGE_DEFAULT&#x27;</span>] = timedelta(seconds=<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<hr>
<p>ä»Flaskéƒ¨ç½²ï¼Œåˆ°Dockerfilleé…ç½®PILç¯å¢ƒï¼Œå†åˆ°docker-composeç®¡ç†ä»¥åŠNginxåå‘ä»£ç†ï¼Œè¸©äº†å¾ˆå¤šå‘ï¼Œä¹Ÿå­¦åˆ°äº†ä¸å°‘ä¸œè¥¿ï¼Œç†è§£äº†å¾ˆå¤šã€‚å®è·µå‡ºçœŸçŸ¥ï¼ˆ<del>ç»™æˆ‘å“­ğŸ˜­</del>ï¼‰</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><p><a target="_blank" rel="noopener" href="https://www.dongwm.com/post/use-docker-compose/">Pythoné¡¹ç›®å®¹å™¨åŒ–å®è·µ(ä¸€) - Docker Compose</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://pythonspeed.com/articles/docker-connection-refused/">Connection refused? Docker networking and how it impacts your image</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://flask.palletsprojects.com/en/1.1.x/api/?highlight=_external">Flask API æ–‡æ¡£</a></p>
</li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>æœ¬æ–‡ä½œè€…ï¼š </strong>Seeno
  </li>
  <li class="post-copyright-link">
      <strong>æœ¬æ–‡é“¾æ¥ï¼š</strong>
      <a href="https://umm.js.org/p/506553f1/" title="Docker éƒ¨ç½² Flask App">https://umm.js.org/p/506553f1/</a>
  </li>
  <li class="post-copyright-license">
      <strong>ç‰ˆæƒå£°æ˜ï¼š </strong>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/Python/" rel="tag"># Python</a>
              <a href="/tags/DevOps/" rel="tag"># DevOps</a>
              <a href="/tags/Docker/" rel="tag"># Docker</a>
              <a href="/tags/Docker-Compose/" rel="tag"># Docker Compose</a>
              <a href="/tags/Flask/" rel="tag"># Flask</a>
              <a href="/tags/Nginx/" rel="tag"># Nginx</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/p/aa85dc73/" rel="prev" title="Java ä¸­ '==' å’Œ equals() çš„ç†è§£">
                  <i class="fa fa-angle-left"></i> Java ä¸­ '==' å’Œ equals() çš„ç†è§£
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/p/e1099939/" rel="next" title="Docker Composeéƒ¨ç½²Jupyter Notebook">
                  Docker Composeéƒ¨ç½²Jupyter Notebook <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments utterances-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank"><a href="http://www.miitbeian.gov.cn" target="_blank">åœ°çƒ ICP å¤‡ 73 å· </a> </a>
  </div>
  <div class="copyright">
    &copy; 2018 â€“ 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Seeno</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>ç«™ç‚¹æ€»å­—æ•°ï¼š</span>
    <span title="ç«™ç‚¹æ€»å­—æ•°">169k</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="æ€»è®¿å®¢é‡">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="æ€»è®¿é—®é‡">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

    </div>
  </footer>

  

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="/lib/animejs/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="/lib/@fancyapps/ui/dist/fancybox/fancybox.umd.js" integrity="sha256-+2+qOqR8CKoHh/AsVR9k2qaDBKWjYNC2nozhYmv5j9k=" crossorigin="anonymous"></script>
  <script src="/lib/lozad/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
  <script src="/lib/pangu/dist/browser/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  <script src="/lib/hexo-generator-searchdb/dist/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/fancybox.js"></script>

  <script src="/js/third-party/pace.js"></script>


  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"/lib/mathjax/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<script class="next-config" data-name="utterances" type="application/json">{"enable":true,"repo":"umm233/blog","issue_term":"title","theme":"github-light"}</script>
<script src="/js/third-party/comments/utterances.js"></script>

</body>
</html>
